const player = "p";
const box = "b";
const goal = "g";
const block = "l";
const fakeblock = "f";
const wall = "w";
 background = "a";
const enemy = "e";


setLegend(
[player, bitmap`
................
................
.....00000......
....00....0.....
...00.0.0.0.....
...0......0.....
...0..0..00.....
....0..00.0.....
....00...00.....
.....00000......
.......0........
....0000000.....
.......0........
......0.0.......
.....00.00......
....00...00.....`],
[box, bitmap `
................
................
................
................
...777777777....
...7...7...7....
...7...7...7....
...7...7...7....
...777777777....
...7...7...7....
...7...7...7....
...7...7...7....
...777777777....
................
................
................`],
[goal, bitmap`
................
................
................
................
................
......44444.....
.....44...44....
.....4......4...
....44......4...
...44......44...
...4.......4....
...44.....44....
....4444444.....
................
................
................`],
[wall, bitmap`
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000
0000000000000000`],
[block, bitmap`
................
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
..777777777777..
................
................`],
  [fakeblock, bitmap`
................
..577777777775..
..755777777755..
..775577775577..
..777557555777..
..777757577777..
..777755577777..
..777755777777..
..777555577777..
..777577557777..
..775577755777..
..775777775557..
..755777777755..
..577777777775..
................
................`],
  [background,bitmap`
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999
9999999999999999`],
  [enemy, bitmap`
......3...3.....
......3...3.....
......3...3.....
.....3333333....
....33333333....
...3663366333...
...3663366333...
...3333333333...
...3333333333...
...3333333333...
...3333333333...
...33333333333..
...33333333333..
...33333333333..
...3333333333...
.....333333.....`]
  );

let level = 0;
const levels =
  [map`
....
p.bg
....`,map`
......lg
......l.
......l.
......lb
......l.
.p......`,map`
plllllaa
afabglal
alllalal
allaalal
alllllal
aaaaaaal`,map`
eee...
..e.lb
p.e.e.
..e.l.
e...lg`,map`
plgeeel
.efefll
.eb.f..
.l..el.
.leeel.
.......`,map`
p..lg
...e.
.b.f.
...f.`]

setBackground(background);

const currentlevel =levels[level];
setMap(currentlevel);

addText("HP:200" ,{x: 1,y: 1});

setSolids([player,box,wall,block]);

setPushables({[player]: [player,box]});

onInput("s", () => {
  getFirst(player).y +=1;
});

onInput("w", () => {
  getFirst(player).y -=1;
});

onInput("d", () => {
  getFirst(player).x +=1;
});

onInput("a", () => {
  getFirst(player).x -=1;
});

onInput("j", () => {
  const currentlevel = levels[level];

  if(currentlevel !== undefined){
    clearText("");
    addText("HP:200" ,{x: 1,y: 1});
setMap(currentlevel);
  }
});

var hp = 200;

afterInput(() => {
  const playerOnEnemy = tilesWith(enemy, player).length;

  if (playerOnEnemy > 0) {
    hp -= 200; 

    clearText();
    addText("HP:" + hp, {x: 1, y: 1});

    if (hp <= 0) {
      hp = 200;
      clearText();
      addText("HP:200", {x: 1, y: 1});
      setMap(levels[level]); 
    }
  }
});

afterInput(() => {

  const targetnumber = tilesWith(goal).length

  const numbercovered = tilesWith(goal,box).length

  if(numbercovered === targetnumber){
    level += 1;

    const currentlevel = levels[level];

    if(currentlevel !== undefined){
      setMap(currentlevel);
    } else {
      addText("you win" ,{y: 4})
    }
  }
});